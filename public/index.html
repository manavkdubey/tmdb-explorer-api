<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TMDB Explorer</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<style>
body{background:linear-gradient(135deg,#0b0d12 0%,#1a1d29 100%);color:#e6e9ef;min-height:100vh}
.navbar{background:rgba(21,26,35,0.95);backdrop-filter:blur(10px);border-bottom:1px solid #243046}
.card{background:#151a23;border:1px solid #1e2633;border-radius:12px;transition:all 0.3s ease;box-shadow:0 4px 6px rgba(0,0,0,0.1)}
.card:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,0.2);border-color:#7db7ff}
.form-control, .form-select{background:#0f141b;border:1px solid #243046;color:#e6e9ef;border-radius:8px;transition:all 0.3s ease}
.form-control:focus, .form-select:focus{background:#0f141b;color:#e6e9ef;border-color:#7db7ff;box-shadow:0 0 0 0.2rem rgba(125,183,255,0.25)}
.btn-primary{background:linear-gradient(45deg,#7db7ff,#5a9fd4);border:none;border-radius:8px;font-weight:600;transition:all 0.3s ease}
.btn-primary:hover{background:linear-gradient(45deg,#6ba6f0,#4a8bc4);transform:translateY(-1px);box-shadow:0 4px 12px rgba(125,183,255,0.3)}
.btn-outline-light{border:1px solid #243046;color:#e6e9ef;border-radius:8px;transition:all 0.3s ease}
.btn-outline-light:hover{background:#243046;border-color:#7db7ff;color:#7db7ff}
.poster{width:100%;border-radius:8px;transition:transform 0.3s ease}
.poster:hover{transform:scale(1.05)}
.poster-sm{width:58px;height:87px;object-fit:cover;border-radius:6px}
.badge{background:linear-gradient(45deg,#7db7ff,#5a9fd4);border:none;border-radius:20px;font-weight:500}
a{color:#7db7ff;text-decoration:none;transition:color 0.3s ease}
a:hover{color:#9cc7ff}
       .modal-content{background:#121722;border:1px solid #1e2633;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.5)}
       .modal-header{border-bottom:1px solid #1e2633}
       .modal-footer{border-top:1px solid #1e2633}
       .modal-backdrop{background-color:rgba(0,0,0,0.7)}
       .loading{text-align:center;padding:2rem;color:#7db7ff}
       .loading i{animation:spin 1s linear infinite}
       @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
       .hero{background:linear-gradient(135deg,rgba(125,183,255,0.1) 0%,rgba(90,159,212,0.1) 100%);border-radius:16px;padding:2rem;margin-bottom:2rem;border:1px solid rgba(125,183,255,0.2)}
       .loading-spinner{display:inline-block;width:40px;height:40px;border:4px solid rgba(125,183,255,0.3);border-top:4px solid #7db7ff;border-radius:50%;animation:spin 1s linear infinite}
       .loading-text{color:#7db7ff;font-size:1.1rem;margin-top:1rem}
       .error-card{background:#2d1b1b;border:1px solid #5c2c2c;border-radius:12px;padding:2rem;text-align:center}
       .error-icon{font-size:3rem;color:#ff6b6b;margin-bottom:1rem}
       .retry-btn{background:linear-gradient(45deg,#ff6b6b,#e74c3c);border:none;border-radius:8px;color:white;padding:0.75rem 1.5rem;font-weight:600;cursor:pointer;transition:all 0.3s ease}
       .retry-btn:hover{background:linear-gradient(45deg,#e74c3c,#c0392b);transform:translateY(-1px)}
       .success-message{background:#1b2d1b;border:1px solid #2c5c2c;border-radius:8px;padding:1rem;margin-bottom:1rem;color:#4ade80;text-align:center}
       .pulse{animation:pulse 2s infinite}
       @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
</style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
  <div class="container">
    <a class="navbar-brand fw-bold" href="#"><i class="bi bi-film me-2"></i>TMDB Explorer</a>
    <div class="navbar-nav ms-auto">
      <span class="navbar-text small text-secondary">Powered by TMDB API</span>
    </div>
  </div>
</nav>

<div class="container py-5 mt-5">
  <div class="hero text-center mb-4">
    <h1 class="display-4 fw-bold mb-3"><i class="bi bi-film me-3"></i>TMDB Explorer</h1>
    <p class="lead mb-4">Discover movies, TV shows, and celebrities from The Movie Database</p>
  </div>

  <div class="card mb-4 shadow-lg">
    <div class="card-body p-4">
      <div class="row g-3">
        <div class="col-md-5">
          <div class="input-group">
            <span class="input-group-text bg-dark border-secondary"><i class="bi bi-search"></i></span>
            <input id="q" class="form-control" placeholder="Search movies, TV shows, people...">
          </div>
        </div>
        <div class="col-md-2">
          <select id="type" class="form-select">
            <option value="multi">All</option>
            <option value="movie">Movies</option>
            <option value="tv">TV Shows</option>
            <option value="person">People</option>
          </select>
        </div>
        <div class="col-md-2">
          <input id="year" type="number" class="form-control" placeholder="Year" min="1900" max="2030">
        </div>
        <div class="col-md-2">
          <button id="search" class="btn btn-primary w-100">
            <i class="bi bi-search me-1"></i>Search
          </button>
        </div>
        <div class="col-md-1">
          <button id="trending" class="btn btn-outline-light w-100" title="Trending Today">
            <i class="bi bi-fire"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

         <div id="loading" class="loading" style="display:none">
           <div class="loading-spinner"></div>
           <div class="loading-text">Loading amazing content...</div>
         </div>

  <div id="results" class="row g-4"></div>

         <div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="modalTitle" aria-hidden="true">
           <div class="modal-dialog modal-lg modal-dialog-scrollable">
             <div class="modal-content">
               <div class="modal-header">
                 <h5 class="modal-title" id="modalTitle"></h5>
                 <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
               </div>
               <div class="modal-body">
                 <div class="row">
                   <div class="col-md-4">
                     <img id="modalPoster" class="poster" alt="Poster">
                   </div>
                   <div class="col-md-8">
                     <div id="modalOverview" class="mb-3"></div>
                     <div id="modalFacts" class="small text-secondary mb-3"></div>
                     <div>
                       <strong>Cast</strong>
                       <div id="modalCast" class="mt-2"></div>
                     </div>
                   </div>
                 </div>
               </div>
             </div>
           </div>
         </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
  ? 'http://localhost:8000' 
  : 'https://tmdb-explorer-api-one.vercel.app'
const STUDENT_SECRET = 'tmdb-explorer-2024' // replace with your secret before deploy
const IMG = 'https://image.tmdb.org/t/p/w300'
const IMG_BIG = 'https://image.tmdb.org/t/p/w500'

       async function fetchJSON(url, opts = {}, retries = 3){
         const headers = {
           'Content-Type': 'application/json',
           ...opts.headers
         }
         try {
           const res = await fetch(url, { ...opts, headers })
           if(!res.ok) {
             if(res.status === 502 && retries > 0) {
               console.log(`Retrying request, ${retries} attempts left...`)
               await new Promise(resolve => setTimeout(resolve, 2000))
               return fetchJSON(url, opts, retries - 1)
             }
             throw new Error(`Request failed: ${res.status}`)
           }
           return await res.json()
         } catch(e) {
           if(retries > 0 && e.message.includes('502')) {
             console.log(`Retrying request, ${retries} attempts left...`)
             await new Promise(resolve => setTimeout(resolve, 2000))
             return fetchJSON(url, opts, retries - 1)
           }
           throw e
         }
       }

       function tplCard(item){
         const media = item.media_type || (item.first_air_date ? 'tv' : (item.release_date ? 'movie' : 'person'))
         const title = item.title || item.name
         const date = item.release_date || item.first_air_date || ''
         const poster = item.poster_path ? (item.poster_path.startsWith('/images/') ? item.poster_path : IMG+item.poster_path) : ''
         const rating = item.vote_average ? Math.round(item.vote_average*10)/10 : null
         const overview = (item.overview||'').slice(0,120)
         const year = date ? new Date(date).getFullYear() : ''
         return `<div class="col-sm-6 col-md-4 col-lg-3">
           <div class="card h-100">
             <div class="position-relative">
               ${poster?`<img class="poster" src="${poster}" alt="${title}" style="height:300px;object-fit:cover;">`:'<div class="d-flex align-items-center justify-content-center bg-secondary" style="height:300px;"><i class="bi bi-image fs-1 text-muted"></i></div>'}
               ${rating?`<span class="badge position-absolute top-0 end-0 m-2">⭐ ${rating}</span>`:''}
             </div>
             <div class="card-body d-flex flex-column">
               <h6 class="card-title mb-2 fw-bold">${title}</h6>
               <div class="small text-secondary mb-2">
                 ${year ? `<i class="bi bi-calendar3 me-1"></i>${year}` : ''}
                 ${media === 'movie' ? '<i class="bi bi-film ms-2"></i> Movie' : media === 'tv' ? '<i class="bi bi-tv ms-2"></i> TV Show' : '<i class="bi bi-person ms-2"></i> Person'}
               </div>
               <p class="small text-muted flex-grow-1">${overview || 'No overview available'}</p>
               <div class="d-flex gap-2 mt-auto">
                 ${media!=='person'?`<button class="btn btn-sm btn-primary flex-grow-1" data-id="${item.id}" data-type="${media}" onclick="openDetails(${item.id}, '${media}')"><i class="bi bi-info-circle me-1"></i>Details</button>`:''}
                 <a class="btn btn-sm btn-outline-light" target="_blank" href="https://www.themoviedb.org/${media}/${item.id}"><i class="bi bi-box-arrow-up-right"></i></a>
               </div>
             </div>
           </div>
         </div>`
       }

       async function search(){
         if(!q.value.trim()) {
           showMessage('Please enter a search term', 'warning')
           return
         }
         if(searchBtn.disabled) return // Prevent multiple clicks
         searchBtn.disabled = true
         showLoading('Searching for amazing content...')
         try {
           const body = { secret: STUDENT_SECRET, query: q.value.trim(), media_type: type.value, page: 1 }
           const y = parseInt(year.value,10); if(!isNaN(y)) body.year = y
           const data = await fetchJSON(`${API_BASE}/tmdb/search`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) })
           const searchResults = data.results || []
           if(searchResults.length === 0) {
             results.innerHTML = '<div class="col-12 text-center text-secondary py-5"><i class="bi bi-search fs-1 mb-3"></i><h4>No results found</h4><p>Try a different search term or check your spelling</p></div>'
           } else {
             results.innerHTML = searchResults.map(tplCard).join('')
             showMessage(`Found ${searchResults.length} amazing results!`, 'success')
           }
         } catch(e) {
           results.innerHTML = '<div class="col-12 text-center text-danger py-5"><i class="bi bi-exclamation-triangle fs-1 mb-3"></i><h4>Search failed</h4><p>Please try again</p></div>'
         } finally {
           hideLoading()
           searchBtn.disabled = false
         }
       }

       async function trendingNow(){
         if(trendingBtn.disabled) return // Prevent multiple clicks
         trendingBtn.disabled = true
         showLoading('Loading trending content...')
         try {
           const body = { secret: STUDENT_SECRET, media_type: 'all', time_window: 'day' }
           const data = await fetchJSON(`${API_BASE}/tmdb/trending`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) })
           const trendingResults = data.results || []
           if(trendingResults.length === 0) {
             results.innerHTML = '<div class="col-12 text-center text-secondary py-5"><i class="bi bi-fire fs-1 mb-3"></i><h4>No trending content</h4><p>Check back later for trending movies and shows</p></div>'
           } else {
             results.innerHTML = trendingResults.map(tplCard).join('')
             showMessage(`Loaded ${trendingResults.length} trending items!`, 'success')
           }
         } catch(e) {
           results.innerHTML = '<div class="col-12 text-center text-danger py-5"><i class="bi bi-exclamation-triangle fs-1 mb-3"></i><h4>Failed to load trending</h4><p>Please try again</p></div>'
         } finally {
           hideLoading()
           trendingBtn.disabled = false
         }
       }

       function showLoading(message = 'Loading...'){
         const loadingEl = document.getElementById('loading')
         const textEl = loadingEl.querySelector('.loading-text')
         textEl.textContent = message
         loadingEl.style.display = 'block'
         results.innerHTML = ''
       }

       function hideLoading(){
         document.getElementById('loading').style.display = 'none'
       }

       function showMessage(message, type = 'info'){
         const messageEl = document.createElement('div')
         messageEl.className = `alert alert-${type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info'} alert-dismissible fade show`
         messageEl.innerHTML = `
           <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
           ${message}
           <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
         `
         results.insertBefore(messageEl, results.firstChild)
         setTimeout(() => messageEl.remove(), 5000)
       }

       function showError(title, message, retryFn){
         results.innerHTML = `
           <div class="col-12">
             <div class="error-card">
               <div class="error-icon">
                 <i class="bi bi-exclamation-triangle"></i>
               </div>
               <h4 class="text-danger mb-3">${title}</h4>
               <p class="text-secondary mb-4">${message}</p>
               <button class="retry-btn" onclick="${retryFn.name}()">
                 <i class="bi bi-arrow-clockwise me-2"></i>Try Again
               </button>
             </div>
           </div>
         `
       }

       async function openDetails(id, media){
         showLoading('Loading details...')
         try {
           const body = { secret: STUDENT_SECRET, id, media_type: media }
           const data = await fetchJSON(`${API_BASE}/tmdb/details`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) })
           modalTitle.textContent = data.title || data.name
           modalOverview.textContent = data.overview || 'No overview available'
           modalPoster.src = data.poster_path ? (data.poster_path.startsWith('/images/') ? data.poster_path : IMG_BIG+data.poster_path) : ''
           const facts = []
           if(data.release_date||data.first_air_date) facts.push(`Released: ${data.release_date||data.first_air_date}`)
           if(data.runtime) facts.push(`Runtime: ${data.runtime} min`)
           if(data.number_of_seasons) facts.push(`Seasons: ${data.number_of_seasons}`)
           if(data.vote_average) facts.push(`Rating: ${Math.round(data.vote_average*10)/10}`)
           modalFacts.textContent = facts.join(' · ')
           const cast = (data.credits && data.credits.cast ? data.credits.cast.slice(0,8) : [])
           modalCast.innerHTML = cast.map(c=>`<span class="badge text-bg-secondary me-1 mb-1">${c.name}</span>`).join('') || '<span class="text-secondary">N/A</span>'
           new bootstrap.Modal(document.getElementById('detailsModal')).show()
         } catch(e) {
           showMessage('Failed to load details. Please try again.', 'warning')
         } finally {
           hideLoading()
         }
       }

searchBtnInit()
function searchBtnInit(){
  window.q = document.getElementById('q')
  window.type = document.getElementById('type')
  window.year = document.getElementById('year')
  window.searchBtn = document.getElementById('search')
  window.trendingBtn = document.getElementById('trending')
  window.results = document.getElementById('results')
  window.modalTitle = document.getElementById('modalTitle')
  window.modalOverview = document.getElementById('modalOverview')
  window.modalPoster = document.getElementById('modalPoster')
  window.modalFacts = document.getElementById('modalFacts')
  window.modalCast = document.getElementById('modalCast')
  
  searchBtn.addEventListener('click', search)
  trendingBtn.addEventListener('click', trendingNow)
  q.addEventListener('keypress', (e) => e.key === 'Enter' && search())
  
         // Load trending content on page load with a welcome message
         setTimeout(() => {
           showMessage('Welcome to TMDB Explorer! Loading trending content...', 'info')
           trendingNow()
         }, 500)
}
</script>
</body>
</html>
